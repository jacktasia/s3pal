<html>
 <title>s3pal uploader</title>
 <style type="text/css">
	.box {
		float:left;width:300px;height:350px;float:left;border:1px solid black;margin:5px;padding:5px;
	}
 </style>
 <body>

	<div class="box">
		<h2>Upload</h2>

		<p id="msg">Drag/Drop file below</p>
		<form action="http://localhost:8080/upload/file" method="post" enctype="multipart/form-data" id="upload-form">
			<input type="file" name="file" id="file" style="width:200px;height:200px;border:1px dashed #ccc;;">
			<input type="hidden" name="prefix" value="test_">
			<br>
			<br>
			<input type="button" id="upload" value="Upload">
			<br>
		</form>
	</div>

	<div class="box">
		<h2>Result</h2>
		<div id="result"></div>
	</div>

	<script>
		var uploadForm = document.getElementById("upload-form");

		var doUpload = function() {
			uploadForm.style.display = 'none';
			document.getElementById("msg").innerHTML = 'Uploading...';

			var uploadData = new FormData(uploadForm);
			var xhr = new XMLHttpRequest();

			xhr.onreadystatechange = function(e) {
				if (xhr.readyState === 4) {
					document.getElementById("msg").innerHTML = 'Done.';
					document.getElementById('result').innerHTML = xhr.responseText;
				}
			}
			xhr.open("POST", "http://localhost:8080/upload/file", true);

			console.log(uploadData);
			xhr.send(uploadData);
		}

		uploadForm.addEventListener("change", function(e) {
			doUpload();
		});

		document.getElementById('upload').addEventListener("click", function(e) {
			doUpload();
		});


	</script>
 </body>
 </html>
